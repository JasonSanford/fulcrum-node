{"version":3,"sources":["../../src/resources/media-base.js"],"names":["MediaResource","file","attributes","attrs","formData","FormData","accessKey","hasOwnProperty","uuid","v4","append","resourceName","track","fileOptions","filename","fileName","body","headers","options","optionsForUpload","client","api","post","createAction","version","find","media","versions","includes","Error","join","fetch","then","resp","Resource","List","includeInto","Find","Create"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;IAEqBA,a;;;;;;;;;;qCACFC,I,EAAMC,U,EAAY;AACjC,UAAMC,QAAQD,cAAc,EAA5B;AACA,UAAME,WAAW,IAAIC,kBAAJ,EAAjB;;AAEA,UAAMC,YAAYH,MAAMI,cAAN,CAAqB,WAArB,IAAoCJ,MAAMG,SAA1C,GAAsDE,eAAKC,EAAL,EAAxE;;AAEAL,eAASM,MAAT,CAAmB,KAAKC,YAAxB,mBAAoDL,SAApD;;AAEA,UAAIH,MAAMI,cAAN,CAAqB,OAArB,CAAJ,EAAmC;AACjCH,iBAASM,MAAT,CAAmB,KAAKC,YAAxB,cAA+CR,MAAMS,KAArD;AACD;;AAED,UAAIC,cAAc,IAAlB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAIV,MAAMI,cAAN,CAAqB,UAArB,CAAJ,EAAsC;AACpCM,sBAAc,EAAEC,UAAUX,MAAMY,QAAlB,EAAd;AACD;;AAEDX,eAASM,MAAT,CAAmB,KAAKC,YAAxB,aAA8CV,IAA9C,EAAoDY,WAApD;;AAEA,aAAO;AACLG,cAAMZ,QADD;AAELa,iBAAS;AACP,0BAAgB;AADT;AAFJ,OAAP;AAMD;;;;2GAEYhB,I,EAAMC,U;;;;;;AACXgB,uB,GAAU,KAAKC,gBAAL,CAAsBlB,IAAtB,EAA4BC,UAA5B,C;;uBAEG,KAAKkB,MAAL,CAAYC,GAAZ,CAAgBC,IAAhB,CAAqB,KAAKC,YAA1B,EAAwCL,OAAxC,C;;;AAAbF,oB;iDAECA,KAAK,KAAKL,YAAV,C;;;;;;;;;;;;;;;;;;;6GAGGL,S;YAAWkB,O,uEAAU,U;;;;;;;uBACX,KAAKC,IAAL,CAAUnB,SAAV,C;;;AAAdoB,qB;;oBAED,KAAKC,QAAL,CAAcC,QAAd,CAAuBJ,OAAvB,C;;;;;sBACG,IAAIK,KAAJ,6BAAoC,KAAKF,QAAL,CAAcG,IAAd,CAAmB,IAAnB,CAApC,O;;;kDAGDC,MAAML,MAAMF,OAAN,CAAN,EACJQ,IADI,CACC;AAAA,yBAAQC,KAAKjB,IAAb;AAAA,iBADD,C;;;;;;;;;;;;;;;;;;EAlDgCkB,c;;kBAAtBlC,a;;;AAuDrBmC,eAAKC,WAAL,CAAiBpC,aAAjB;AACAqC,eAAKD,WAAL,CAAiBpC,aAAjB;AACAsC,iBAAOF,WAAP,CAAmBpC,aAAnB","file":"media-base.js","sourcesContent":["import uuid from 'uuid';\nimport FormData from 'form-data';\n\nimport List from '../actions/list';\nimport Find from '../actions/find';\nimport Create from '../actions/create';\nimport Resource from './base';\n\nexport default class MediaResource extends Resource {\n  optionsForUpload(file, attributes) {\n    const attrs = attributes || {};\n    const formData = new FormData();\n\n    const accessKey = attrs.hasOwnProperty('accessKey') ? attrs.accessKey : uuid.v4();\n\n    formData.append(`${this.resourceName}[access_key]`, accessKey);\n\n    if (attrs.hasOwnProperty('track')) {\n      formData.append(`${this.resourceName}[track]`, attrs.track);\n    }\n\n    let fileOptions = null;\n\n    // File names from media streams like\n    // fs.createReadStream('photo.jpg')\n    // are automatically added. When reading from buffers like\n    // fs.readFileSync('photo.jpg)\n    // the file name can't be inferred so it must be supplied like\n    // photos.create(fs.readFileSync('photo.jpg'), {fileName: 'photo.jpg'})\n    if (attrs.hasOwnProperty('fileName')) {\n      fileOptions = { filename: attrs.fileName };\n    }\n\n    formData.append(`${this.resourceName}[file]`, file, fileOptions);\n\n    return {\n      body: formData,\n      headers: {\n        'Content-Type': null\n      }\n    };\n  }\n\n  async create(file, attributes) {\n    const options = this.optionsForUpload(file, attributes);\n\n    const body = await this.client.api.post(this.createAction, options);\n\n    return body[this.resourceName];\n  }\n\n  async media(accessKey, version = 'original') {\n    const media = await this.find(accessKey);\n\n    if (!this.versions.includes(version)) {\n      throw new Error(`Version must be one of ${this.versions.join(', ')}.`);\n    }\n\n    return fetch(media[version])\n      .then(resp => resp.body);\n  }\n}\n\nList.includeInto(MediaResource);\nFind.includeInto(MediaResource);\nCreate.includeInto(MediaResource);\n"]}